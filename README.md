# WeTalk - ä¸ºç°ä»£æ²Ÿé€šè€Œç”Ÿ

WeTalk æ˜¯ä¸€æ¬¾åŠŸèƒ½ä¸°å¯Œã€ä½“éªŒæµç•…çš„å®æ—¶èŠå¤©åº”ç”¨ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªé«˜æ•ˆã€å¯é ä¸”ç¾è§‚çš„æ²Ÿé€šå¹³å°ã€‚æ— è®ºæ˜¯ç§ä¸‹å¯†è¯­ã€å¥½å‹åˆ†äº«ï¼Œè¿˜æ˜¯å›¢é˜Ÿåä½œï¼ŒWeTalk éƒ½èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚

## âœ¨ äº§å“è®¾è®¡

WeTalk çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ **ç®€æ´ã€é«˜æ•ˆã€å®æ—¶**ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œæ²Ÿé€šå·¥å…·æœ¬èº«ä¸åº”æˆä¸ºæ²Ÿé€šçš„éšœç¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰“é€ äº†ä¸€ä¸ªç•Œé¢æ¸…çˆ½ã€äº¤äº’è‡ªç„¶çš„ç”¨æˆ·ç•Œé¢ï¼Œå¹¶ç¡®ä¿æ¶ˆæ¯ä¼ é€’çš„å³æ—¶æ€§ï¼Œè®©æ¯ä¸€æ¬¡å¯¹è¯éƒ½å¦‚è¡Œäº‘æµæ°´èˆ¬é¡ºç•…ã€‚

### æ ¸å¿ƒåŠŸèƒ½

*   **ç”¨æˆ·ç³»ç»Ÿ**: æ”¯æŒç”¨æˆ·æ³¨å†Œã€ç™»å½•å’Œä¸ªäººèµ„æ–™ç®¡ç†ã€‚
*   **å¥½å‹å…³ç³»**: ç”¨æˆ·å¯ä»¥æœç´¢ã€æ·»åŠ å’Œç®¡ç†å¥½å‹ï¼Œæ„å»ºè‡ªå·±çš„ç¤¾äº¤ç½‘ç»œã€‚
*   **å®æ—¶å•èŠ**: ä¸å¥½å‹è¿›è¡Œä¸€å¯¹ä¸€çš„å®æ—¶æ–‡å­—ã€è¡¨æƒ…èŠå¤©ã€‚
*   **ç¾¤ç»„èŠå¤©**: åˆ›å»ºå’ŒåŠ å…¥ç¾¤ç»„ï¼Œæ»¡è¶³å¤šäººåä½œå’Œè®¨è®ºçš„éœ€æ±‚ã€‚
*   **æ¶ˆæ¯ç®¡ç†**: å®æ—¶æ¥æ”¶å’Œå‘é€æ¶ˆæ¯ï¼Œä¿è¯æ²Ÿé€šçš„å³æ—¶æ€§ã€‚

## ğŸš€ æŠ€æœ¯æ¶æ„

WeTalk é‡‡ç”¨ä¸šç•Œå‰æ²¿çš„ **å‰åç«¯åˆ†ç¦»** æ¶æ„ï¼Œç¡®ä¿äº†é¡¹ç›®çš„é«˜å†…èšã€ä½è€¦åˆï¼ŒåŒæ—¶ä¹Ÿä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œç»´æŠ¤æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚

![Architecture Diagram](https://your-image-url-here.com/architecture.png)
*(è¿™æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œæ‚¨å¯ä»¥åç»­æ›¿æ¢ä¸ºçœŸå®çš„æ¶æ„å›¾)*

### 
| **åˆ†ç±»** | **æŠ€æœ¯æ ˆ** | **è¯´æ˜** |
| :--- | :--- | :--- |
| **åç«¯** | [NestJS](https://nestjs.com/), [TypeScript](https://www.typescriptlang.org/), [MongoDB](https://www.mongodb.com/), [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API) | åŸºäº Node.js çš„ä¼ä¸šçº§æ¡†æ¶ï¼Œæä¾›å¼ºå¤§çš„æ¨¡å—åŒ–å’Œå¯ä¼¸ç¼©æ€§ã€‚ |
| **å‰ç«¯** | [React 19](https://react.dev/), [Vite](https://vitejs.dev/), [TypeScript](https://www.typescriptlang.org/), [Tailwind CSS](https://tailwindcss.com/), [Zustand](https://github.com/pmndrs/zustand) | ç°ä»£ã€é«˜æ•ˆçš„ UI å¼€å‘æ¡†æ¶ï¼Œæä¾›å“è¶Šçš„å¼€å‘ä½“éªŒå’Œè¿è¡Œæ—¶æ€§èƒ½ã€‚ |
| **ä»£ç è´¨é‡** | ESLint, Prettier | ç»Ÿä¸€çš„ä»£ç é£æ ¼å’Œè§„èŒƒï¼Œä¿è¯äº†ä»£ç çš„ä¸€è‡´æ€§å’Œå¯è¯»æ€§ã€‚ |

### åç«¯æ·±åº¦è§£æ (Server)

åç«¯æœåŠ¡åŸºäº **NestJS** æ„å»ºï¼Œå……åˆ†åˆ©ç”¨äº†å…¶é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„ç‰¹æ€§ï¼Œæ„å»ºäº†ä¸€ä¸ªç»“æ„æ¸…æ™°ã€æ˜“äºæ‰©å±•çš„æ¨¡å—åŒ–åº”ç”¨ã€‚

*   **æ¨¡å—åŒ–è®¾è®¡**: æ ¸å¿ƒåŠŸèƒ½å¦‚ `User`, `Auth`, `Message`, `Group`, `Friend` éƒ½è¢«æ‹†åˆ†ä¸ºç‹¬ç«‹çš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æƒè´£åˆ†æ˜ã€‚
*   **æ•°æ®åº“**: é€‰ç”¨ **MongoDB** ä½œä¸ºä¸»æ•°æ®åº“ï¼Œé€šè¿‡ `Mongoose` åº“è¿›è¡Œå¯¹è±¡æ•°æ®å»ºæ¨¡ï¼ˆODMï¼‰ã€‚MongoDB çš„æ–‡æ¡£æ¨¡å‹éå¸¸é€‚åˆå­˜å‚¨èŠå¤©è®°å½•å’Œç”¨æˆ·é…ç½®ç­‰åŠç»“æ„åŒ–æ•°æ®ã€‚
*   **å®æ—¶é€šä¿¡**: é€šè¿‡ **NestJS Gateway** (`socket.io` çš„å°è£…) å®ç°äº† WebSocket æœåŠ¡ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›äº†ä½å»¶è¿Ÿçš„æ¶ˆæ¯æ¨é€å’Œå®æ—¶äº‹ä»¶é€šçŸ¥ã€‚
*   **è®¤è¯æœºåˆ¶**: `AuthModule` æš—ç¤ºäº†é¡¹ç›®ä½¿ç”¨äº†å®‰å…¨çš„è®¤è¯æ–¹å¼ï¼ˆå¾ˆå¯èƒ½æ˜¯ JWT - JSON Web Tokensï¼‰ï¼Œä¿æŠ¤ç”¨æˆ·è´¦æˆ·å’Œ API æ¥å£å®‰å…¨ã€‚
*   **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**: é€šè¿‡è‡ªå®šä¹‰ `HttpExceptionFilter`ï¼Œå®ç°äº†å…¨å±€çš„é”™è¯¯æ•è·å’Œæ ‡å‡†åŒ–å“åº”ï¼Œæå‡äº† API çš„å¥å£®æ€§ã€‚

#### æ•°æ®åº“æ¨¡å‹è®¾è®¡ç¤ºä¾‹ (Mongoose Schema)

ä¸ºäº†ä¿è¯æ•°æ®çš„ç»“æ„åŒ–å’Œä¸€è‡´æ€§ï¼Œæˆ‘ä»¬ä¸ºæ ¸å¿ƒä¸šåŠ¡å¯¹è±¡è®¾è®¡äº†æ¸…æ™°çš„ Schemaã€‚ä»¥"æ¶ˆæ¯"æ¨¡å‹ä¸ºä¾‹ï¼Œå…¶ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š

```typescript
// server/src/server/message/message.dto/message.schema.ts
import { Schema } from 'mongoose';

export const messageSchema = new Schema({
  content: { type: String, required: true },
  sender: { type: String, required: true },
  receiver: { type: String },
  roomId: { type: String },
  messageType: {
    type: String,
    required: true,
    enum: ['private', 'room'],
  },
  createdAt: { type: Date, default: Date.now },
  senderInfo: { /* ... */ },
  receiverInfo: { /* ... */ },
  groupInfo: { /* ... */ },
  readStatus: { type: Boolean, default: false },
});

// åˆ›å»ºå¤åˆç´¢å¼•ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
messageSchema.index({ sender: 1, receiver: 1 });
messageSchema.index({ roomId: 1 });
```
è¿™ä¸ª Schema ä¸ä»…å®šä¹‰äº†æ¶ˆæ¯çš„åŸºæœ¬å­—æ®µå’Œç±»å‹ï¼Œè¿˜é€šè¿‡ `enum` è¿›è¡Œäº†æ¶ˆæ¯ç±»å‹çº¦æŸï¼Œå¹¶ä¸”ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µï¼ˆå¦‚ `sender`, `receiver`, `roomId`ï¼‰å»ºç«‹äº†ç´¢å¼•ï¼Œè¿™æ˜¯æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–çš„å…³é”®å®è·µã€‚

### å‰ç«¯æ·±åº¦è§£æ (Client)

å‰ç«¯åº”ç”¨æ˜¯ä¸€ä¸ªä½¿ç”¨ **Vite** + **React 19** æ„å»ºçš„ç°ä»£åŒ–å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ï¼Œæ³¨é‡å¼€å‘æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚

*   **é—ªç”µèˆ¬çš„å¼€å‘ä½“éªŒ**: **Vite** æä¾›äº†åŸºäºåŸç”Ÿ ES-Module çš„å¼€å‘æœåŠ¡å™¨ï¼Œå®ç°äº†æ¯«ç§’çº§çš„çƒ­æ¨¡å—é‡è½½ï¼ˆHMRï¼‰ï¼Œæå¤§åœ°æå‡äº†å¼€å‘æ•ˆç‡ã€‚
*   **ç°ä»£ React**: ä½¿ç”¨ **React 19**ï¼Œå¯ä»¥åˆ©ç”¨å…¶æœ€æ–°çš„ç‰¹æ€§ï¼Œå¦‚å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰ï¼Œå¸¦æ¥æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚
*   **è½»é‡çº§çŠ¶æ€ç®¡ç†**: é‡‡ç”¨ **Zustand** è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†ã€‚å…¶ç®€æ´çš„ API å’ŒåŸºäº Hooks çš„è®¾è®¡èŒƒå¼ï¼Œè®©çŠ¶æ€é€»è¾‘æ¸…æ™°æ˜“æ‡‚ï¼ŒåŒæ—¶é¿å…äº† Redux ç­‰åº“çš„æ¨¡æ¿ä»£ç ã€‚`zustand-persist` ä¸­é—´ä»¶ç”¨äºå°†ç”¨æˆ·ä¼šè¯ç­‰å…³é”®çŠ¶æ€æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨ã€‚
*   **åŸå­åŒ– CSS ä¸ç»„ä»¶åº“**: **Tailwind CSS** çš„ä½¿ç”¨ä½¿å¾—æ„å»ºé«˜åº¦å®šåˆ¶åŒ–çš„ UI å˜å¾—ç®€å•é«˜æ•ˆã€‚ç»“åˆ **daisyUI**ï¼Œåœ¨ä¸å¤±çµæ´»æ€§çš„å‰æä¸‹ï¼Œå¿«é€Ÿæ­å»ºå‡ºç¾è§‚çš„ç»„ä»¶ã€‚
*   **æµç•…åŠ¨ç”»**: é›†æˆ **Framer Motion** (`motion`)ï¼Œä¸º UI å…ƒç´ æ·»åŠ å¹³æ»‘ã€æœ‰æ„ä¹‰çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œæ˜¾è‘—æå‡äº†äº§å“çš„äº¤äº’è´¨æ„Ÿã€‚
*   **ç±»å‹å®‰å…¨**: å‰åç«¯å‡ä½¿ç”¨ **TypeScript**ï¼Œä¿è¯äº†æ•°æ®çš„ç±»å‹å®‰å…¨ï¼Œå‡å°‘äº†è¿è¡Œæ—¶é”™è¯¯ï¼Œä½¿å¾—å¤§å‹é¡¹ç›®åä½œæ›´ä¸ºå¯é ã€‚

#### ç»„ä»¶åŒ–ä¸ç»“æ„è®¾è®¡

å‰ç«¯ä»£ç ç»“æ„æ¸…æ™°ï¼Œé€šè¿‡é«˜åº¦æŠ½è±¡çš„ç»„ä»¶å’Œåˆç†çš„ç›®å½•åˆ’åˆ†ï¼Œå®ç°äº†é«˜æ•ˆçš„ä»£ç å¤ç”¨å’Œå¯ç»´æŠ¤æ€§ã€‚

*   **å¸ƒå±€ç»„ä»¶ (`Layout.tsx`)**: åº”ç”¨çš„æ ¸å¿ƒå¸ƒå±€è¢«æŠ½è±¡ä¸º `Layout` ç»„ä»¶ï¼Œå®ƒè´Ÿè´£æ•´åˆä¾§è¾¹æ ï¼ˆè”ç³»äººã€è®¾ç½®ï¼‰å’Œä¸»èŠå¤©çª—å£ï¼Œæ˜¯å•é¡µåº”ç”¨ç»“æ„çš„åŸºç¡€ã€‚
*   **é€šç”¨ç»„ä»¶ (`components/common/`)**: é¡¹ç›®ä¸­å¤§é‡å¯å¤ç”¨çš„ UI å…ƒç´ ï¼Œå¦‚ `Button`, `Input`, `Avatar` ç­‰ï¼Œéƒ½è¢«æŠ½ç¦»åˆ° `common` ç›®å½•ä¸­ã€‚è¿™ç§å®è·µé¿å…äº†ä»£ç å†—ä½™ï¼Œå¹¶ä¿è¯äº†åº”ç”¨å†… UI çš„ä¸€è‡´æ€§ã€‚
*   **ä¸šåŠ¡ç»„ä»¶ (`components/chat/`, `components/contact/`)**: ä¸ç‰¹å®šä¸šåŠ¡é€»è¾‘ç´§å¯†è€¦åˆçš„ç»„ä»¶ï¼ˆå¦‚èŠå¤©æ°”æ³¡ã€è”ç³»äººåˆ—è¡¨é¡¹ï¼‰è¢«ç»„ç»‡åœ¨å„è‡ªçš„ç›®å½•ä¸­ï¼Œä½¿å¾—é¡¹ç›®ç»“æ„ä¸€ç›®äº†ç„¶ã€‚

ä»¥ä¸»é¢˜åˆ‡æ¢ç»„ä»¶ä¸ºä¾‹ï¼Œå®ƒå±•ç¤ºäº†çŠ¶æ€ç®¡ç† (`Zustand`) ä¸ UI ç»„ä»¶çš„ä¼˜é›…ç»“åˆï¼š

```tsx
// client/src/components/ThemeSwitcher.tsx

import { useThemeStore } from "@/store/theme"; // 1. å¼•å…¥ Zustand Store
import { Moon, Sun } from "lucide-react";

const ThemeSwitcher = () => {
  // 2. ä» Store ä¸­è·å–å½“å‰ä¸»é¢˜å’Œåˆ‡æ¢æ–¹æ³•
  const { theme, toggleTheme } = useThemeStore();

  return (
    <label className="swap swap-rotate">
      <input
        type="checkbox"
        className="theme-controller"
        value="synthwave"
        checked={theme === "dark"}
        onChange={toggleTheme} // 3. ç»‘å®šäº‹ä»¶ï¼Œè°ƒç”¨ Store çš„ action
      />
      <Sun className="swap-on fill-current w-6 h-6" />
      <Moon className="swap-off fill-current w-6 h-6" />
    </label>
  );
};

export default ThemeSwitcher;
```
è¿™ä¸ªå°ç»„ä»¶è‡ªèº«é€»è¾‘å†…èšï¼Œé€šè¿‡ `useThemeStore` è¿™ä¸ª Hook ä¸å…¨å±€çŠ¶æ€è¿æ¥ï¼ŒèŒè´£å•ä¸€ï¼Œå¯è¢«è½»æ¾æ”¾ç½®åœ¨åº”ç”¨ä»»ä½•éœ€è¦çš„åœ°æ–¹ï¼Œæ˜¯ç»„ä»¶åŒ–æ€æƒ³çš„å®Œç¾ä½“ç°ã€‚

## ğŸŒŸ é¡¹ç›®ä¼˜ç‚¹

*   **æŠ€æœ¯æ ˆå…ˆè¿›**: é€‰ç”¨äº† React/NestJS/Vite ç­‰ç¤¾åŒºçƒ­é—¨ä¸”å¼ºå¤§çš„æŠ€æœ¯ï¼Œé¡¹ç›®å…·æœ‰å¾ˆé«˜çš„æŠ€æœ¯ä»·å€¼ã€‚
*   **é«˜å†…èšä½è€¦åˆ**: æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œä½¿å¾—åŠŸèƒ½æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚
*   **å¼€å‘ä½“éªŒä¼˜ç§€**: Vite å’Œ NestJS CLI æä¾›äº†é¡¶çº§çš„å¼€å‘å·¥å…·é“¾ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚
*   **ä»£ç è´¨é‡å¯æ§**: é›†æˆäº†å®Œæ•´çš„ Linting å’Œ Formatting å·¥å…·é“¾ã€‚
*   **å®æ—¶ä½“éªŒ**: åŸºäº WebSocket çš„æ¶æ„ä¸ºç”¨æˆ·æä¾›äº†æµç•…çš„å®æ—¶æ²Ÿé€šä½“éªŒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

*   [Node.js](https://nodejs.org/) (>= 18.x)
*   [pnpm](https://pnpm.io/)
*   [MongoDB](https://www.mongodb.com/try/download/community)

### åç«¯å¯åŠ¨

```bash
# è¿›å…¥ server ç›®å½•
cd server

# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡
pnpm run start:dev
```

### å‰ç«¯å¯åŠ¨

```bash
# è¿›å…¥ client ç›®å½•
cd client

# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡
pnpm run dev
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:5173` (æˆ–å…¶ä»– Vite æŒ‡å®šçš„ç«¯å£) æ¥è®¿é—® WeTalk åº”ç”¨ã€‚

---

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å’Œå±•ç¤º WeTalk é¡¹ç›®ï¼
